
    
  - name: EJECUTAR COMANDOS
    vars:
     comando: "docker-compose -f ../{{ item.0.escenario }}/docker-compose.yml exec -T {{ item.0.servicio }} {{ item.1.comando }} | grep {{ item.1.resultado }}"
    shell: "{{ comando }}"
    register: testresult
    changed_when:
     - '"failed" in testresult.stderr'
     - result.rc != 0
    loop: "{{ lookup('subelements', comandos, 'comandos', {'skip_missing': True}) }}"
    loop_control:
     label: "EJECUTANDO {{ comando }}"
    no_log: False

  # - name: ESCRIBIR LOG
  #   shell: |
  #    echo "Salida comando: {{ item.cmd }}: {{ item.stdout }}" >> log/report.log
  #    echo "Código salida comando: {{ item.rc }}" >> log/report.log     
  #    if [[ "{{ item.stderr }}" ]];then echo "Error: {{ item.stderr }}" >> log/report.log;fi
  #    if [ "{{ item.rc }}" -eq 0 ]; then echo "Puntuación: {{ item.item.1.puntuacion }}" >> log/report.log;fi     
  #   loop: "{{ testresult.results }}"
  #   no_log: False
  #   ignore_errors: yes
    


 
